<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Golden-Depths.png" type="image/png">
    <title>Golden Depths</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #1e1e1e;
            color: #f1f1f1;
            overflow: hidden;
            position: relative;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            grid-template-rows: repeat(8, 50px);
            gap: 1px;
            margin-bottom: 20px;
            position: relative;
        }

        .cell {
            width: 50px;
            height: 50px;
            background-color: #333;
            border: 1px solid #444;
            position: relative;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .cell.current-room {
            background-color: #4CAF50;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.6);
        }

        .stench::after {
            content: "S";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: red;
        }

        .breeze::after {
            content: "B";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: #6bbf7c;
        }

        .glitter::after {
            content: "G";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: gold;
        }

        .info {
            margin-bottom: 20px;
            font-size: 18px;
            color: #ddd;
        }

        .controls button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #444;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .controls button:hover {
            background-color: #555;
        }

        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            font-size: 17px;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from { bottom: 0; opacity: 0; }
            to { bottom: 30px; opacity: 1; }
        }

        @keyframes fadeout {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .stats-container {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
            color: white;
            text-align: left;
        }

        .info-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            font-size: 18px;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .info-button:hover {
            background-color: #45a049;
        }

    </style>
</head>
<body>

    <!-- Info Button -->
    <a href="info.html">
        <button class="info-button">Info</button>
    </a>

    <div class="game-container">
        <h1>Wumpus World Game</h1>

        <!-- Show only the current room and partition -->
        <div class="grid" id="grid"></div>

        <div class="info">
            <p id="roomDescription">You are in room (1, 1) looking down.</p>
        </div>

        <div class="controls">
            <button onclick="movePlayer('up')">Up</button>
            <button onclick="movePlayer('down')">Down</button>
            <button onclick="movePlayer('left')">Left</button>
            <button onclick="movePlayer('right')">Right</button>
            <button onclick="shootArrow()">Shoot Arrow</button>
        </div>

        <div id="toast"></div>
    </div>

    <!-- Stats Display -->
    <div class="stats-container" id="stats">
        <p>Games Played: <span id="gamesPlayed">0</span></p>
        <p>Games Won: <span id="gamesWon">0</span></p>
        <p>Wumpus Killed: <span id="wumpusKilled">0</span></p>
        <p>Gold Found: <span id="goldFound">0</span></p>
        <p>Death by Wumpus: <span id="deathByWumpus">0</span></p>
        <p>Death by Pit: <span id="deathByPit">0</span></p>
        <p>Arrows Shot: <span id="arrowsShot">0</span></p>
    </div>

    <script>
        const gridSize = 8;
        let playerPos = { x: 0, y: 0 };
        let wumpusPos, goldPos, pits = [], arrows = 3;
        let direction = 'down';
        let gameOverMessage = '';
        const restrictedCells = [
            { x: 1, y: 2 },
            { x: 2, y: 1 }
        ];

        // Initialize the game
        function initializeGame() {
            gameOverMessage = '';
            wumpusPos = getRandomPosition();
            goldPos = getRandomPosition();
            pits = [];
            
            while (pits.length < 3) {
                let pit = getRandomPosition();
                if (!isSamePosition(pit, wumpusPos) && !isSamePosition(pit, goldPos)) {
                    pits.push(pit);
                }
            }

            renderGrid();
            updateStats();
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Get random position that isn't in restricted cells
        function getRandomPosition() {
            let pos;
            do {
                pos = { x: randomInt(0, gridSize - 1), y: randomInt(0, gridSize - 1) };
            } while (isRestricted(pos));
            return pos;
        }

        // Check if the position is one of the restricted cells
        function isRestricted(pos) {
            return restrictedCells.some(restricted => restricted.x === pos.x && restricted.y === pos.y);
        }

        function isSamePosition(pos1, pos2) {
            return pos1.x === pos2.x && pos1.y === pos2.y;
        }

        // Render the grid
        function renderGrid() {
            const gridContainer = document.getElementById('grid');
            gridContainer.innerHTML = '';
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (x === playerPos.x && y === playerPos.y) {
                        if (isAdjacentToWumpus(x, y)) cell.classList.add('stench');
                        if (isAdjacentToPit(x, y)) cell.classList.add('breeze');
                        if (isAdjacentToGold(x, y)) cell.classList.add('glitter');
                        cell.classList.add('current-room');
                    }
                    gridContainer.appendChild(cell);
                }
            }
            updateRoomDescription();
        }

        function isAdjacentToWumpus(x, y) {
            return (Math.abs(x - wumpusPos.x) === 1 && y === wumpusPos.y) || (Math.abs(y - wumpusPos.y) === 1 && x === wumpusPos.x);
        }

        function isAdjacentToPit(x, y) {
            return pits.some(pit => Math.abs(x - pit.x) === 1 && Math.abs(y - pit.y) === 1);
        }

        function isAdjacentToGold(x, y) {
            return (Math.abs(x - goldPos.x) === 1 && y === goldPos.y) || (Math.abs(y - goldPos.y) === 1 && x === goldPos.x);
        }

        function updateRoomDescription() {
            let percepts = [];
            if (isAdjacentToWumpus(playerPos.x, playerPos.y)) percepts.push('Stench');
            if (isAdjacentToPit(playerPos.x, playerPos.y)) percepts.push('Breeze');
            if (isAdjacentToGold(playerPos.x, playerPos.y)) percepts.push('Glitter');

            const roomDesc = `You are in room (${playerPos.x + 1}, ${playerPos.y + 1}) looking ${direction}. ${percepts.join(', ') || 'No percepts.'}`;
            document.getElementById('roomDescription').textContent = roomDesc;
        }

        // Move the player in the specified direction
        function movePlayer(directionInput) {
            if (gameOverMessage) return;

            switch (directionInput) {
                case 'up':
                    if (playerPos.y > 0) playerPos.y--;
                    direction = 'up';
                    break;
                case 'down':
                    if (playerPos.y < gridSize - 1) playerPos.y++;
                    direction = 'down';
                    break;
                case 'right':
                    if (playerPos.x < gridSize - 1) playerPos.x++;
                    direction = 'right';
                    break;
                case 'left':
                    if (playerPos.x > 0) playerPos.x--;
                    direction = 'left';
                    break;
            }
            updateGameState();
            renderGrid();
        }

        // Show toast message
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = "show";
            setTimeout(function () { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // Shoot the arrow
        function shootArrow() {
            if (arrows <= 0 || gameOverMessage) return;

            let shootPos = { ...playerPos };

            switch (direction) {
                case 'up':
                    if (shootPos.y > 0) shootPos.y--;
                    break;
                case 'down':
                    if (shootPos.y < gridSize - 1) shootPos.y++;
                    break;
                case 'right':
                    if (shootPos.x < gridSize - 1) shootPos.x++;
                    break;
                case 'left':
                    if (shootPos.x > 0) shootPos.x--;
                    break;
            }

            if (shootPos.x === wumpusPos.x && shootPos.y === wumpusPos.y) {
                showToast("You hit the Wumpus! You win!");
                wumpusPos = null; // Wumpus dies
                updateStats('Wumpus Killed');
                gameOverMessage = "You have killed the Wumpus!";
                updateStats('Games Won');
                renderGrid();
                return;
            } else {
                showToast("The arrow missed.");
            }
            renderGrid();
        }

        // Update game state (win/lose)
        function updateGameState() {
            if (playerPos.x === wumpusPos.x && playerPos.y === wumpusPos.y) {
                gameOverMessage = "The Wumpus ate you!";
                updateStats('Death by Wumpus');
                showToast(gameOverMessage);
                resetGame();
            } else if (pits.some(pit => pit.x === playerPos.x && pit.y === playerPos.y)) {
                gameOverMessage = "You fell into a pit!";
                updateStats('Death by Pit');
                showToast(gameOverMessage);
                resetGame();
            } else if (playerPos.x === goldPos.x && playerPos.y === goldPos.y) {
                gameOverMessage = "You have found the gold! Congratulations, you win!";
                updateStats('Gold Found');
                updateStats('Games Won');
                showToast(gameOverMessage);
                resetGame();
            }
        }

        // Update the statistics in localStorage
        function updateStats(stat) {
            let stats = JSON.parse(localStorage.getItem('gameStats')) || {
                'Games Played': 0,
                'Games Won': 0,
                'Wumpus Killed': 0,
                'Gold Found': 0,
                'Death by Wumpus': 0,
                'Death by Pit': 0,
                'Arrows Shot': 0
            };

            stats['Games Played']++;
            if (stat === 'Games Won') {
                stats['Games Won']++;
            } else if (stat === 'Wumpus Killed') {
                stats['Wumpus Killed']++;
            } else if (stat === 'Gold Found') {
                stats['Gold Found']++;
            } else if (stat === 'Death by Wumpus') {
                stats['Death by Wumpus']++;
            } else if (stat === 'Death by Pit') {
                stats['Death by Pit']++;
            } else if (stat === 'Arrows Shot') {
                stats['Arrows Shot']++;
            }

            localStorage.setItem('gameStats', JSON.stringify(stats));
            renderStats();
        }

        // Render the stats display
        function renderStats() {
            const stats = JSON.parse(localStorage.getItem('gameStats')) || {
                'Games Played': 0,
                'Games Won': 0,
                'Wumpus Killed': 0,
                'Gold Found': 0,
                'Death by Wumpus': 0,
                'Death by Pit': 0,
                'Arrows Shot': 0
            };

            document.getElementById('gamesPlayed').textContent = stats['Games Played'];
            document.getElementById('gamesWon').textContent = stats['Games Won'];
            document.getElementById('wumpusKilled').textContent = stats['Wumpus Killed'];
            document.getElementById('goldFound').textContent = stats['Gold Found'];
            document.getElementById('deathByWumpus').textContent = stats['Death by Wumpus'];
            document.getElementById('deathByPit').textContent = stats['Death by Pit'];
            document.getElementById('arrowsShot').textContent = stats['Arrows Shot'];
        }

        // Reset the game
        function resetGame() {
            setTimeout(() => {
                gameOverMessage = '';
                initializeGame();
                playerPos = { x: 0, y: 0 };
                arrows = 3;
                renderGrid();
            }, 2000); 
        }

        // Initialize the stats on page load
        renderStats();
        initializeGame();
    </script>
</body>
</html>
